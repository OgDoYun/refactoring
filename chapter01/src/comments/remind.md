## 리펙터링의 첫 단계
- 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.
- 리팩터링의 첫단계는 성공 / 실패를 반환하는 테스트 코드를 작성하는 것이다.

### 함수로 추출하기
	let result = `청구 내역 (고객명: ${invoice.customer})\n`;
	for (let perf of invoice.performances) {
- 먼저 별로 함수로 빼냈을 때 유효범위를 벗어나는 변수, 즉 새 함수에서는 곧바로 사용할 수 없는 변수가 있는지 확인한다.
  - `perf`, `play`, `thisAmount`가 여기에 속한다.
- 조금씩 수정하여 피드백 주기를 짧게 가져가는 습관을 들이자.
- 리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래야 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.
- 컴퓨터가 이해하는 코드는 바보도 작성할 수 있다. 사람이 이해하도록 작성하는 프로그래머가 진정한 실력자다.
- 함수추출은 `컨트롤 + 시프트 + R`을 누르면 된다.
- 함수이름을 잘 짓는 것은 중요하다.
  - 하지만 곧바로 좋은 이름은 생각나기 어렵다.
  - 그래서 중요한 것은 일단 함수로 빼놔야지 이름만 쉽게 변경이 가능하다.

### 임시변수를 질의함수로 바꾸기
- 변수를 하나 바꿀 때마다, 컴파일-테스트-커밋을 하면 된다.
  - 돌이켜보면 나는 항상 커밋에 많은 내용을 담으려 했던 것 같다. 많은 내용을 담는 다면 브랜치를 나누는 방법으로 기능을 추가하는 것이 맞다는 생각이 든다.

### 반복문 쪼개기
- 이 전까지 반복문은 성능을 위해 되도록 적게 돌아야한다고 생각했는데, 리팩터링을 위해서 때로는 일부러 늘릴 수도 있다는 생각을 처음해보았다.
 - 연산 또는 저장 비용보다 유지보수하는 사람의 비용을 더 줄여야 한다는 게 어떤 의미인지 조금은 알 것 같다.
 - 코드를 쉽게 읽기 위해(리펙터링) 루프를 두 번 작성하더라도, 최신 컴파일러들은 이를 캐시해두고 더 똑똑하게 컴파일하는 경우도 있다.
 - 가끔 리펙터링으로 인해 성능 이슈가 생길 수 있지만, 이를 개선하는 데에 필요한 것이 다시 리펙터링이기에 저자는 개의치 않고 하라고 이야기한다.

### volomeCredits 변수를 제거하는 단계
- 반복문 쪼개기
- 문장 슬라이스하기
- 함수 추출하기
- 변수 인라인하기
> 항상 이런 단계를 거치고 컴파일-테스트-커밋을 하기는 힘들지만, 상황이 복잡할수록 더욱 절실하다. 혹시 다음 단계에서 테스트에 실패하더라도 이전 커밋으로 돌아가면 쉽게 문제가 해결되기 때문이다.

---

## 계산 단계와 포맷팅 단계 분리하기